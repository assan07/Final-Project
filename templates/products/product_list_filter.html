<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/product_lists.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/index.css') }}"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="card-list-barang row g-4">
      <!-- Product 1 -->
      {% for barang in barang_data %}
      <div class="product-card">
        <a href="/products/product_details/{{ barang['_id'] }}">
          <div class="product-card card shadow-sm">
            <div
              class="img-barang d-flex align-content-center justify-content-center"
            >
              <img
                src="{{ url_for('static', filename='images/gambar_barang/' ~ barang['foto']) }}"
                class="card-img-top"
                alt="{{ barang.brand }}"
                onerror="{{ url_for('static', filename='images/gambar_barang/download_1.jpg') }}"
              />
            </div>

            <div class="card-body">
              <h5 class="card-title fw-bold">{{ barang.nama_barang }}</h5>
              <p class="card-text">{{ barang.kategori }}</p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="price-display text-primary fw-bold"
                  >Rp. {{ barang.harga}}</span
                >
              </div>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $(document).ready(function () {
          $(".filter-btn").click(function () {
            const kategori = $(this).data("kategori").toUpperCase();

            // AJAX request to filter products
            $.ajax({
              url: "/products/product_lists/filter",
              type: "GET",
              data: { kategori: kategori },
              success: function (response) {
                // Perbarui kontainer produk
                $("#product-container").html(response);

                // Fungsi untuk memformat angka ke format rupiah
                function formatCurrency(value) {
                  return new Intl.NumberFormat("id-ID", {
                    style: "decimal",
                    minimumFractionDigits: 0,
                  }).format(value);
                }

                // Terapkan format harga ke elemen dengan kelas price-display
                $(".price-display").each(function () {
                  const originalValue = parseFloat("{{ barang_data['harga'] }}");
                  if (!isNaN(originalValue)) {
                    $(this).text(formatCurrency(originalValue));
                  }
                });
              },
              error: function () {
                alert("Failed to load products. Please try again.");
              },
            });
          });
        });
      });
    </script>
  </body>
</html>
